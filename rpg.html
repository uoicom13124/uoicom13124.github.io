<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Advanced Mobile RPG</title>
    <style>
        body {
            background-color: #111;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
            overflow: hidden; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô */
        }
        canvas {
            border: 4px solid #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            background-color: #000;
        }
        /* Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏•‡∏∞ UI */
        #mobile-ui {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏õ‡∏ó‡∏µ‡πà Canvas ‡πÑ‡∏î‡πâ */
        }
        #controls, #action-buttons {
            position: absolute;
            pointer-events: all; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÑ‡∏î‡πâ */
            padding: 10px;
        }
        
        /* D-Pad controls (‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á) */
        #controls {
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
        }
        .dpad-btn {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: rgba(76, 175, 80, 0.7);
            border: 2px solid #388E3C;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border-radius: 8px;
            touch-action: manipulation;
        }
        #up-btn { top: 0; left: 50px; }
        #down-btn { bottom: 0; left: 50px; }
        #left-btn { top: 50px; left: 0; }
        #right-btn { top: 50px; right: 0; }
        .dpad-btn:active { background-color: #388E3C; }

        /* ‡∏õ‡∏∏‡πà‡∏° Action (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) */
        #action-buttons {
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .action-btn {
            padding: 10px 15px;
            background-color: rgba(0, 150, 255, 0.7);
            border: 2px solid #0056b3;
            border-radius: 5px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            pointer-events: all;
            touch-action: manipulation;
        }
        .action-btn:active { background-color: #0056b3; }

        /* ‡∏õ‡∏∏‡πà‡∏° Fullscreen (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) */
        #fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 150px; /* ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° Action */
            padding: 8px 12px;
            background-color: rgba(255, 87, 34, 0.7);
            border: 2px solid #D32F2F;
            border-radius: 5px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            pointer-events: all;
            touch-action: manipulation;
        }
        #fullscreen-btn:active { background-color: #D32F2F; }

        /* Battle System UI (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô) */
        #battle-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #battle-log {
            width: 80%;
            height: 100px;
            background-color: #333;
            border: 2px solid #fff;
            padding: 10px;
            overflow-y: scroll;
            margin-bottom: 20px;
        }
        .battle-btn {
            padding: 10px 20px;
            margin: 5px;
            background-color: #007bff;
            border: none;
            color: white;
            cursor: pointer;
        }
    </style>
    <script src="https://unpkg.com/kaboom@3000/dist/kaboom.js"></script>
</head>
<body>

    <div id="mobile-ui">
        <button id="fullscreen-btn">‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠</button>

        <div id="action-buttons">
            <button class="action-btn" id="inventory-btn">üéí ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á</button>
            <button class="action-btn" id="attack-btn">‚öîÔ∏è ‡πÇ‡∏à‡∏°‡∏ï‡∏µ</button>
        </div>
        
        <div id="controls">
            <div class="dpad-btn" id="up-btn" data-dir="up">‚ñ≤</div>
            <div class="dpad-btn" id="down-btn" data-dir="down">‚ñº</div>
            <div class="dpad-btn" id="left-btn" data-dir="left">‚óÄ</div>
            <div class="dpad-btn" id="right-btn" data-dir="right">‚ñ∂</div>
        </div>
    </div>
    
    <div id="battle-screen">
        <h2 id="battle-title">‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô!</h2>
        <p id="enemy-stats"></p>
        <div id="battle-log"></div>
        <div id="battle-actions">
            <button class="battle-btn" onclick="playerAttack()">‡πÇ‡∏à‡∏°‡∏ï‡∏µ</button>
            <button class="battle-btn" onclick="runAway()">‡∏´‡∏ô‡∏µ</button>
        </div>
    </div>

    <script>
        // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Kaboom ‡πÅ‡∏•‡∏∞ Canvas
        kaboom({
            width: 400,
            height: 400,
            canvas: document.querySelector("#gameCanvas"),
            letterbox: true, // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î
            scale: 1,
        });

        // 2. Load Assets (‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á)
        // Kaboom ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î "Sprite" (‡∏†‡∏≤‡∏û) ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠
        loadSprite("player", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAACzXTVzAAAAAXNSR0IArs4c6QAAADFJREFUGFdjZEACz//o3bV3N9bCwMiAoY4BkwC0YAwMYWk0i4MhQIAAGHwGAQAKg/1n09/kfgAAAABJRU5ErkJggg==", {
            sliceX: 1, sliceY: 1, 
        });
        loadSprite("wall", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAACzXTVzAAAAAXNSR0IArs4c6QAAAEFJREFUGFdjZEACT/+p3bV3N9ZgQBAfAwMEJcSAqI4BkwC0YAwMYWk0i4MhQIAAGHwGAQAKgw8s4M+o3bUAAEA5D/l2Ld7BPAAAAABJRU5ErkJggg==", {
            sliceX: 1, sliceY: 1, 
        });
        loadSprite("tree", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAACzXTVzAAAAAXNSR0IArs4c6QAAAEJJREFUGFdjZGBg+M8AgygM/n8Qh4pB5g8EBYGhhcE/BkYwBhjQ8e9S8M/AwMAQWgc/h/gPMQ5Dgw8M4KMAAMqY3+j0t3uCAAAAAElFTkSuQmCC", {
            sliceX: 1, sliceY: 1, 
        });
        loadSprite("monster", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAACzXTVzAAAAAXNSR0IArs4c6QAAAEJJREFUGFdjZGBg+M9AIiAMg8EBBjQ+g4AAYeD/YpB5GxkQhQIBgwB0YIwMYWk0i4MhQIAAGHwGAQAKg/1n09/kfgAAAABJRU5ErkJggg==", {
            sliceX: 1, sliceY: 1, 
        });
        loadSprite("potion", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUAAAAcAAAAHCAYAAACzXTVzAAAAAXNSR0IArs4c6QAAADpJREFUGFdjZGBg+M8AgygMf8XzHyEGA0o/h/gPMQ5Dgw8M4KMAAMD/g/j/g3hQhYIBFw0AAMs+J5wBw7zYAAAAAElFTkSuQmCC", {
            sliceX: 1, sliceY: 1, 
        });

        // Map configuration
        const TILE_SIZE = 40; // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á
        const MAP_SIZE = 30; // ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 30x30 ‡∏ä‡πà‡∏≠‡∏á (‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å)
        const GENERATION_DENSITY = 0.2; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ (20%)
        const ENEMY_DENSITY = 0.05; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π (5%)

        // Inventory
        let inventory = {
            potion: 0,
            gold: 0,
        };

        // Battle State
        let currentEnemy = null;
        let playerStats = { hp: 100, atk: 15, def: 5 };
        let enemyStats = {};
        
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (Procedural Generation) ---
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Array ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á
        function generateMap() {
            const mapArray = [];
            for (let y = 0; y < MAP_SIZE; y++) {
                const row = [];
                for (let x = 0; x < MAP_SIZE; x++) {
                    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡πÅ‡∏û‡∏á
                    if (x === 0 || x === MAP_SIZE - 1 || y === 0 || y === MAP_SIZE - 1) {
                        row.push("w"); // wall
                    } 
                    // ‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
                    else if (Math.random() < GENERATION_DENSITY) {
                        row.push("t"); // tree
                    } 
                    // ‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏≤‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π
                    else if (Math.random() < ENEMY_DENSITY) {
                        row.push("e"); // enemy
                    }
                    // ‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
                    else if (Math.random() < 0.01) {
                        row.push("p"); // potion (1%)
                    }
                    else {
                        row.push(" "); // ground
                    }
                }
                mapArray.push(row.join(""));
            }
            return mapArray;
        }
        

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: Scene Game (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å) ---

        scene("game", () => {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤ Scene
            const generatedMap = generateMap();

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Layout Game (‡πÉ‡∏ä‡πâ map() ‡∏Ç‡∏≠‡∏á Kaboom)
            const level = addLevel(generatedMap, {
                tileWidth: TILE_SIZE,
                tileHeight: TILE_SIZE,
                tiles: {
                    "w": () => [
                        sprite("wall"),
                        area(),
                        solid(), // ‡∏ä‡∏ô‡πÑ‡∏î‡πâ
                        "wall"
                    ],
                    "t": () => [
                        sprite("tree"),
                        area(),
                        solid(),
                        "tree"
                    ],
                    "e": () => [
                        sprite("monster"),
                        area(),
                        "enemy" // ‡πÅ‡∏ó‡πá‡∏Å‡∏®‡∏±‡∏ï‡∏£‡∏π
                    ],
                    "p": () => [
                        sprite("potion"),
                        area(),
                        "item"
                    ],
                    " ": () => [], // ‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡πà‡∏≤
                }
            });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Player
            const player = add([
                sprite("player"),
                pos(TILE_SIZE * 2, TILE_SIZE * 2), // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà (2, 2)
                area(),
                solid(),
                "player",
                {
                    speed: 200,
                    inventory: inventory,
                    stats: playerStats,
                }
            ]);

            // Camera ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Player
            player.onUpdate(() => {
                camPos(player.pos);
            });
            
            // Text UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            const statusText = add([
                text(`HP: ${player.stats.hp} | Gold: ${inventory.gold}`, { size: 16 }),
                fixed(), // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Text ‡∏ï‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏°‡πà‡∏Ç‡∏¢‡∏±‡∏ö
                pos(10, 10),
                z(100),
            ]);

            player.onUpdate(() => {
                statusText.text = `HP: ${player.stats.hp} | Gold: ${inventory.gold} | Potion: ${inventory.potion}`;
            });

            // ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô (‡πÉ‡∏ä‡πâ 'key' event ‡πÅ‡∏ó‡∏ô 'onKeyPress' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö RPG)
            onKeyPress("up", () => player.move(0, -player.speed));
            onKeyPress("down", () => player.move(0, player.speed));
            onKeyPress("left", () => player.move(-player.speed, 0));
            onKeyPress("right", () => player.move(player.speed, 0));

            // ‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏Å‡∏±‡∏ö‡∏®‡∏±‡∏ï‡∏£‡∏π (Battle System Trigger)
            player.onCollide("enemy", (e) => {
                if (currentEnemy === null) {
                    currentEnemy = e;
                    enemyStats = { hp: randi(30, 60), atk: randi(8, 15), def: randi(0, 5) };
                    e.destroy(); // ‡∏•‡∏ö Sprite ‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                    go("battle"); // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Scene ‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ
                }
            });
            
            // ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
            player.onCollide("item", (i) => {
                inventory.potion++;
                i.destroy();
                statusText.text = "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Potion! " + statusText.text;
            });
        });

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Scene Battle (‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÄ‡∏ö‡∏™) ---

        scene("battle", () => {
            document.getElementById("battle-screen").style.display = 'flex';
            logBattle(`‡πÄ‡∏à‡∏≠‡∏®‡∏±‡∏ï‡∏£‡∏π! HP: ${enemyStats.hp}`);
            updateBattleStats();
        });

        function logBattle(message) {
            const log = document.getElementById("battle-log");
            log.innerHTML += `<p>${message}</p>`;
            log.scrollTop = log.scrollHeight; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
        }

        function updateBattleStats() {
            document.getElementById("battle-title").innerText = `HP ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ${playerStats.hp}`;
            document.getElementById("enemy-stats").innerText = `‡∏®‡∏±‡∏ï‡∏£‡∏π: HP ${enemyStats.hp} | ATK ${enemyStats.atk}`;
        }
        
        function playerAttack() {
            if (playerStats.hp <= 0) return;

            // ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏à‡∏°‡∏ï‡∏µ
            let playerDmg = Math.max(0, playerStats.atk - enemyStats.def);
            enemyStats.hp -= playerDmg;
            logBattle(`‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏®‡∏±‡∏ï‡∏£‡∏π ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ${playerDmg}`);

            if (enemyStats.hp <= 0) {
                logBattle("‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ!");
                currentEnemy = null;
                inventory.gold += randi(5, 15);
                endBattle();
                return;
            }

            // ‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÇ‡∏à‡∏°‡∏ï‡∏µ
            enemyTurn();
            updateBattleStats();
        }

        function enemyTurn() {
            let enemyDmg = Math.max(0, enemyStats.atk - playerStats.def);
            playerStats.hp -= enemyDmg;
            logBattle(`‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏Ñ‡∏∏‡∏ì ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ${enemyDmg}`);
            
            if (playerStats.hp <= 0) {
                logBattle("‡∏Ñ‡∏∏‡∏ì‡∏û‡πà‡∏≤‡∏¢‡πÅ‡∏û‡πâ! Game Over!");
                endBattle(true);
            }
        }
        
        function runAway() {
            if (Math.random() > 0.5) { // 50% ‡∏´‡∏ô‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                logBattle("‡∏´‡∏ô‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                endBattle();
            } else {
                logBattle("‡∏´‡∏ô‡∏µ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏™‡∏ß‡∏ô!");
                enemyTurn();
                updateBattleStats();
            }
        }

        function endBattle(isGameOver = false) {
            currentEnemy = null;
            document.getElementById("battle-screen").style.display = 'none';
            document.getElementById("battle-log").innerHTML = ''; // Clear log

            if (isGameOver) {
                go("game_over");
            } else {
                go("game"); // ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            }
        }
        
        // Scene Game Over
        scene("game_over", () => {
            add([
                text("Game Over!", { size: 32 }),
                pos(center()),
                origin("center"),
            ]);
            add([
                text("‡∏Å‡∏î Spacebar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà", { size: 16 }),
                pos(center().x, center().y + 40),
                origin("center"),
            ]);
            onKeyPress("space", () => {
                // Reset stats and inventory before restarting
                playerStats = { hp: 100, atk: 15, def: 5 };
                inventory = { potion: 0, gold: 0 };
                go("game");
            });
        });

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ ---
        
        // ‡∏ü‡∏±‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏° D-Pad
        document.querySelectorAll('.dpad-btn').forEach(button => {
            button.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const dir = button.getAttribute('data-dir');
                // Kaboom ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô onKeyPress ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ
                // ‡πÄ‡∏£‡∏≤‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ Kaboom ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
                keyPress(dir);
            });
        });
        
        // ‡∏õ‡∏∏‡πà‡∏° Inventory
        document.getElementById('inventory-btn').onclick = () => {
            alert(`--- Inventory ---\nGold: ${inventory.gold}\nPotion: ${inventory.potion}`);
        };

        // ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏°‡∏ï‡∏µ (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)
        document.getElementById('attack-btn').onclick = () => {
            alert("‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!");
        };

        // ‡∏õ‡∏∏‡πà‡∏° Fullscreen
        document.getElementById('fullscreen-btn').onclick = () => {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) { /* Safari */
                document.documentElement.webkitRequestFullscreen();
            }
        };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
        go("game");
    </script>
</body>
</html>
