<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Random RPG</title>
<style>
  body {
    margin:0;
    overflow:hidden;
    background:#111;
  }

  canvas {
    display:block;
    margin:auto;
    background:#000;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const TILE = 32;

// ===== สร้างแมพแบบสุ่ม =====
const mapWidth = Math.ceil(canvas.width / TILE);
const mapHeight = Math.ceil(canvas.height / TILE);

const map = [];
for (let y = 0; y < mapHeight; y++) {
  map[y] = [];
  for (let x = 0; x < mapWidth; x++) {
    map[y][x] = Math.random() < 0.2 ? 1 : 0;
  }
}

// ===== ผู้เล่น =====
const player = {
  x: 100,
  y: 100,
  speed: 2,
  size: 24
};

const keys = {};

// ===== input =====
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ===== collision =====
function canWalk(nx, ny) {
  const left = Math.floor(nx / TILE);
  const top = Math.floor(ny / TILE);
  const right = Math.floor((nx + player.size) / TILE);
  const bottom = Math.floor((ny + player.size) / TILE);

  if (
    map[top]?.[left] === 1 ||
    map[top]?.[right] === 1 ||
    map[bottom]?.[left] === 1 ||
    map[bottom]?.[right] === 1
  ) return false;

  return true;
}

// ===== game loop =====
function update() {
  let dx = 0, dy = 0;

  if (keys["w"]) dy -= player.speed;
  if (keys["s"]) dy += player.speed;
  if (keys["a"]) dx -= player.speed;
  if (keys["d"]) dx += player.speed;

  if (canWalk(player.x + dx, player.y)) player.x += dx;
  if (canWalk(player.x, player.y + dy)) player.y += dy;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // draw map
  for (let y = 0; y < mapHeight; y++) {
    for (let x = 0; x < mapWidth; x++) {
      if (map[y][x] === 1) {
        ctx.fillStyle = "#555";
      } else {
        ctx.fillStyle = "#3cb371";
      }
      ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
    }
  }

  // draw player
  ctx.fillStyle = "red";
  ctx.fillRect(player.x, player.y, player.size, player.size);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
